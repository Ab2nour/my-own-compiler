# On teste automatiquement
# le code ANTLR4.

name: CI
on:  push
jobs:
  test-code:
    name: Teste Calculette.g4
    runs-on: ubuntu-latest
        
    steps:    
    - uses: actions/checkout@v2
    
    - name: Test d'expressions simples
      run: |
            cd .
            
            # on récupère toutes les fonctions de functions.sh
            source tools/functions.sh


            # ---------------- Code ----------------
            python3 tests/launch_tests.py
                        
            nb_tests=0
            nb_tests_faux=0
            
            test_expr '3 + 5' '8'
            test_expr "3 * 5" '15'
            test_expr '3 * 5' '15'
            test_expr '3*5' '15'
            test_expr '3 - 5' '-2'
            test_expr '6 / 3' '2'
            
            test_expr 'true and false or true and not true' '0'
            test_expr 'true or false and false' '1'
            test_expr 'true or (false or false)' '1'
            test_expr 'false or (true and not false)' '1'
            test_expr '(not true and false) or (true and not false)' '1'
            

            echo
            echo "-------------------------------------------------------------------"
            echo "🤵 $nb_tests tests ont été effectués."  
            echo
            echo "✅ Il y a $(( nb_tests - nb_tests_faux )) tests passés avec succès."  


            if (( $nb_tests_faux > 0 ))
            then
            echo "❌ Il y a $nb_tests_faux tests faux."  
            exit 42
            fi
            
      shell: bash
