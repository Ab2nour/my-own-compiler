# On teste automatiquement
# le code ANTLR4.

name: CI
on:  push
jobs:
  test-code:
    name: Teste Calculette.g4
    runs-on: ubuntu-latest
        
    steps:    
    - uses: actions/checkout@v2
    
    - name: Test d'expressions simples
      run: |
            cd .
            
            # ---------------- Fonctions ----------------
            chmod +x tools/functions.sh
            sudo tools/functions.sh


            # ---------------- Code ----------------            
            nb_tests=0
            nb_tests_faux=0
            
            test '3 + 5' '8'
            test "3 * 5" '15'
            test '3 * 5' '15'
            test '3*5' '15'
            test '3 - 5' '-2'
            test '6 / 3' '2'
            
            test 'true and false or true and not true' '0'
            test 'true or false and false' '1'
            test 'true or (false or false)' '1'
            test 'false or (true and not false)' '1'
            test '(not true and false) or (true and not false)' '1'

            echo
            echo "-------------------------------------------------------------------"
            echo "🤵 $nb_tests tests ont été effectués."  
            echo
            echo "✅ Il y a $(( nb_tests - nb_tests_faux )) tests passés avec succès."  


            if (( $nb_tests_faux > 0 ))
            then
            echo "❌ Il y a $nb_tests_faux tests faux."  
            exit 42
            fi
            
      shell: bash
